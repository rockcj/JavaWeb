<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.edu.lingnan.mapper.TeacherMapper">

    <resultMap id="TeacherResultMap" type="cn.edu.lingnan.pojo.Teacher">
        <id property="teacherId" column="teacher_id"/>
        <result property="teacherName" column="teacher_name"/>
        <result property="gender" column="gender"/>
        <result property="age" column="age"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="deptId" column="dept_id"/>
        <result property="title" column="title"/>
        <result property="flag" column="tflag"/>
    </resultMap>

    <!-- 查询所有教师 -->
    <select id="queryAllTeachers" resultMap="TeacherResultMap">
        SELECT teacher_id, teacher_name, gender, age, phone, email, dept_id, title, tflag
        FROM teacher
        WHERE tflag = 0
    </select>

    <!-- 根据ID查询教师 -->
    <select id="queryTeacherById" parameterType="String" resultMap="TeacherResultMap">
        SELECT teacher_id, teacher_name, gender, age, phone, email, dept_id, title, tflag
        FROM teacher
        WHERE teacher_id = #{teacherId} AND tflag = 0
    </select>

    <!-- 根据姓名查询教师 -->
    <select id="queryTeacherByName" parameterType="String" resultMap="TeacherResultMap">
        SELECT teacher_id, teacher_name, gender, age, phone, email, dept_id, title, tflag
        FROM teacher
        WHERE teacher_name LIKE CONCAT('%', #{teacherName}, '%') AND tflag = 0
    </select>

    <!-- 根据院系ID查询教师 -->
    <select id="queryTeachersByDeptId" parameterType="String" resultMap="TeacherResultMap">
        SELECT teacher_id, teacher_name, gender, age, phone, email, dept_id, title, tflag
        FROM teacher
        WHERE dept_id = #{deptId} AND tflag = 0
    </select>

    <!-- 根据条件查询教师 -->
    <select id="queryTeacherByCondition" parameterType="map" resultMap="TeacherResultMap">
        SELECT teacher_id, teacher_name, gender, age, phone, email, dept_id, title, tflag
        FROM teacher
        WHERE tflag = 0
        <if test="teacherName != null and teacherName != ''">
            AND teacher_name LIKE CONCAT('%', #{teacherName}, '%')
        </if>
        <if test="deptId != null and deptId != ''">
            AND dept_id = #{deptId}
        </if>
        <if test="title != null and title != ''">
            AND title = #{title}
        </if>
        <if test="gender != null and gender != ''">
            AND gender = #{gender}
        </if>
    </select>

    <!-- 插入教师 -->
    <insert id="insertTeacher" parameterType="cn.edu.lingnan.pojo.Teacher">
        INSERT INTO teacher (teacher_id, teacher_name, gender, age, phone, email, dept_id, title, tflag)
        VALUES (#{teacherId}, #{teacherName}, #{gender}, #{age}, #{phone}, #{email}, #{deptId}, #{title}, #{flag})
    </insert>

    <!-- 更新教师 -->
    <update id="updateTeacher" parameterType="cn.edu.lingnan.pojo.Teacher">
        UPDATE teacher
        SET teacher_name = #{teacherName},
            gender = #{gender},
            age = #{age},
            phone = #{phone},
            email = #{email},
            dept_id = #{deptId},
            title = #{title},
            tflag = #{flag}
        WHERE teacher_id = #{teacherId}
    </update>

    <!-- 删除教师（软删除） -->
    <update id="deleteTeacher" parameterType="String">
        UPDATE teacher
        SET tflag = 1
        WHERE teacher_id = #{teacherId}
    </update>

    <!-- 根据条件删除教师 -->
    <update id="deleteTeacherByCondition" parameterType="map">
        UPDATE teacher
        SET tflag = 1
        WHERE tflag = 0
        <if test="deptId != null and deptId != ''">
            AND dept_id = #{deptId}
        </if>
        <if test="title != null and title != ''">
            AND title = #{title}
        </if>
    </update>

    <!-- 更新教师密码 -->
    <update id="updateTeacherPassword">
        UPDATE teacher
        SET password = #{newPassword}
        WHERE teacher_id = #{teacherId}
    </update>

</mapper>

